I"Ä<p>El passat divendres s‚Äôalliberava el virus de tipus ransomware conegut amb el nom de <b>WannaCry</b> o <b>WannaCrypt</b>, infectant m√©s de 150.000 m√†quines en 74 pa√Øsos, causant el caos per tot el m√≥n i provocant que moltes empreses tinguessin que apagar els servidors i demanar als seus treballats que apaguessin els seus ordinadors, en la ‚Äúciber-infecci√≥‚Äù m√©s gran fins a la data despr√©s del virus ‚ÄúILoveYou‚Äù al 2000.</p>

<p>Com la majoria de ransomwares, un cop s‚Äôha executat xifrava tots els arxius i en demanava un rescat amb bitcoins per a recuperar les dades. La particularitat per√≤, d‚Äôaquesta versi√≥ √©s la seva capacitat per a estendre‚Äôs per la xarxa tot explotant una vulnerabilitat de Windows i infectar tots els ordinadors que la conformen.</p>

<p>En aquesta entrada, anir√© publicant diferents <del>solucions</del> mesures preventives, per a fer front a l‚Äôatac del #WannaCry.</p>

<!--more-->

<ul>
	<li><b>C√≤pies de seguretat</b></li>
Com que no existeix una soluci√≥ mestra per a evitar la infecci√≥, el pas m√©s important ser√† protegir les nostres dades per a restablir tota la nostra informaci√≥, en cas que ens veiem compromesos pel virus.

<blockquote><b>Av√≠s!</b> Degut a que aquest virus s'escampa per dintre de la nostra xarxa, √©s important que tinguem les nostres c√≤pies a√Øllades i protegides (en discs externs, equips desconnectats de la xarxa o sense perm√≠s d'usuari) per a que no es vegin compromeses!</blockquote>

	<li><b>Actualitzar!</b></li>

Tot i que la font d'infecci√≥ encara no est√† clara, si que sabem que la propagaci√≥ del virus per la xarxa utilitza una coneguda vulnerabilitat de SMB (<b><a href="https://technet.microsoft.com/en-us/library/security/ms17-010.aspx" target="_blank">MS17-010</a></b>) que Microsoft va arreglar el passat mes de mar√ß, i que moltes empreses encara no havien actualitzat.

Per tant, el primer pas a fer √©s actualitzar els nostres servidors i equips de sobretaula!

<li><b>Aplicar els "peda√ßos" per als Windows no suportats</b></li>

Degut al gran nombre d'equips que encara utilitzen versions anteriors a Windows 7, com ara Windows XP o Windows Server 2008; Microsoft excepcionalment ha creat uns "peda√ßos" per a arreglar la vulnerabilitat tot i que fa temps que havia anunciat que no en donaria suport.

Podem descarregar els paquets d'actualitzaci√≥ i obtenir m√©s informaci√≥ al seg√ºent article: <a href="https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks" target="_blank">https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks</a>

	<li><b>Bloquejar ports als Firewall</b></li>

Per a evitar tant que el virus "truqui a casa" com es propagui per la nostra xarxa, haurem de bloquejar els seg√ºents ports del nostre firewall: <b>137, 138 UDP i 137, 445 TCP</b>. Alerta! amb aix√≤ tamb√© estarem bloquejant tot el tr√†nsit SMB.

	<li><b>Desinstal¬∑lar de les caracter√≠stiques de Windows</b></li>

Haurem d'anar al Tauler de Control &gt; Programes i Caracter√≠stiques &gt; Activar o Desactivar les caracter√≠stiques de Windows. I desmarcar l'opci√≥ "<b>Compatibilidad con el protocolo para compartir archivos SMB1.0/CIFS</b>"

<p style="text-align: center"><a href="https://bloc.garcad.cat/wp-content/uploads/2017/05/wannacrypt1.png"><img src="https://bloc.garcad.cat/wp-content/uploads/2017/05/wannacrypt1-300x180.png" alt="wannacrypt#1" width="300" height="180" class="aligncenter size-medium wp-image-571" /></a></p>

	<li><b>Deshabilitar el servei SMBv1 des del registre:</b></li>

Haurem de modificar el registre de Windows i crear o modificar l'entrada SMB1 de la seg√ºent clau:

<blockquote><b>Nota:</b> abans de modificar el registre assegurem-nos que hem fet c√≤pia i que podem restaurar-lo en cas que alguna cosa surti malament. Per a m√©s informaci√≥, podeu consultar l'article <a href="https://support.microsoft.com/en-us/help/322756/how-to-back-up-and-restore-the-registry-in-windows" target="_blank">322756</a> de Microsoft on s'explica com fer-ho.</blockquote>

<b>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanManServer\Parameters\</b>

Nom de l'entrada: <b>SMB1</b>
Tipus d'entrada: <b>REG_DWORD</b>
Possibles valors: <b>0 = Deshabilitat</b>, 1 = Habilitat (Per defecte, sense l'entrada, est√† habilitat)

	<li><b>Execuci√≥ de l'script NoMoreCry</b></li>

El CCN-CERT ha desenvolupat una eina per prevenir l'encriptaci√≥ de les dades en cas que s'arribi a executar el WannaCry.

L'script, de forma preventiva, el que fa es accedir a les carpetes personals de l'usuari on s'executa el virus i crear un arxiu buit amb el mateix nom que aquest ho faria "t.wcry" i un cop creat li esborra tots els permisos. D'aquesta forma quan el ransom vol crear l'arxiu per a fer el xifrat "t.wcry" es troba en que aquest ja existeix i com no t√© permisos no el pot sobreescriure, per tant, aqu√≠ finalitza la seva execuci√≥ i les dades queden sense xifrar.

Font per a descarregar l'eina de la p√†gina del CCN-CERT: <a href="https://loreto.ccn-cert.cni.es/index.php/s/tYxMah1T7x7FhND" target="_blank">https://loreto.ccn-cert.cni.es/index.php/s/tYxMah1T7x7FhND</a>

</ul>

<p>Espero que us hagi pogut ajudar i que el #WannaCry no us afecti.</p>
:ET